---
title: "PriorGen update/extensions ver1"
author: "Konstantinos Pateras"
date: "2022-12-15"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Candidates for  inclusion in PriorGen

## Summary of candidate functions
* Updated basic findbeta (original function with percentiles)
    + Mean, Median, Mode
* Raw findbeta (standard location and scale measures (mean,median,mode,variance,range))
    + Mean, Median, Mode
* Abstract findbeta (general statements of how low/high are the mean and variance)
    + Mean
* Panel findbeta (Multiple experts or sources of information contribute to define this prior, based on simple averaging)
    + Mean, Median, Mode
* Updated basic findbetaqq (original functions with 2 percentiles)
    + Percentiles
* Updated basic findbetamupsi (original function with percentiles - two non-linear root functions)
    + Mean
* Raw findbetamupsi (standard location and scale measures (mean, variance))
    + Mean
* Abstract findbetamupsi (general statements of how low/high are the mean and variance)
    + Mean
* Panel findbeta (Multiple experts or sources of information contribute to define this prior, based on simple averaging)
    + Mean
    
* Plot all the above samples function
    + Generic and applicable to all functions above.
    
* New root and optim functions 
    + RootSolve alterantive
    + Optim alternative

\newpage
## Basic findbeta updated
```{r  include=TRUE}
source("~/GitHub/PriorGen-1/R/findbeta.r")
findbeta(themedian = 0.5,lower.v = T,percentile = 0.999,percentile.value = 0.999, silent = F)
#findbeta(themode = 0.5,lower.v = T,percentile = 0.80,percentile.value = 0.95, silent = T)
fb_per=findbeta(themean = 0.5,lower.v = T,percentile = 0.90,percentile.value = 0.95, silent = T)
fb_per$parameters
fb_per$summary
fb_per$input
```
\newpage
## Raw findbeta (mean/median/mode/variance/range input)
```{r include=TRUE}
source("~/GitHub/PriorGen-1/R/findbeta_raw.r")
findbeta_raw(themedian = 0.5,therange = c(0,1), silent = T)
#findbeta_raw(themode = 0.5,therange = c(0,1), silent = T)
fb_raw=findbeta_raw(themean = 0.8,thevariance = 0.2,silent = T)
fb_raw$parameters
fb_raw$summary
fb_raw$input
```
\newpage
## Abstract findbeta (General statements input)
```{r  include=TRUE}
source("~/GitHub/PriorGen-1/R/findbeta_abstract.r")
findbeta_abstract(themean.cat = "Low",thevariance.cat = "High", silent = T) 
#findbeta_abstract(themean.cat = "Very low",thevariance.cat = "Low", silent = T) 
fb_abstract=findbeta_abstract(themean.cat =  "Low",thevariance.cat = "High",silent = T)
fb_abstract$parameters
fb_abstract$summary
fb_abstract$input
```
\newpage
## Panel findbeta (Vector input)
```{r  include=TRUE}
source("~/GitHub/PriorGen-1/R/findbeta_panel.r")
#findbeta_panel(themedian.vec = c(0.2,0.02,0.5,0.03,0.04,0.05),silent = T) 
findbeta_panel(themode.vec = c(0.2,0.02,0.5,0.03,0.04,0.05),silent = F) 
fb_panel=findbeta_panel(themean.vec = c(0.2,0.02,0.5,0.03,0.04,0.05),silent = T) 
fb_panel$parameters
fb_panel$summary
fb_panel$input
```
\newpage
## Basic findbetaqq updated (Percentiles input)
```{r  include=TRUE}
source("~/GitHub/PriorGen-1/R/findbetaqq.r")
require(rootSolve)
fb_qq=findbetaqq(percentile.value1 = 0.3,percentile1 = 0.20,
                 percentile.value2 = 0.7,percentile2 = 0.97,silent=T) 
fb_qq$parameters
fb_qq$summary
fb_qq$input
```
\newpage
## Basic findbetamupsi updated (Hierarchical input  + choice of root function)
```{r  include=TRUE}
source("~/GitHub/PriorGen-1/R/findbetamupsi.r")
require(rootSolve)
require(nleqslv)
fb_mupsi_RS=findbetamupsi(themean=0.20, percentile=0.99, lower.v=TRUE,
              percentile.value=0.30, psi.percentile=0.90,
              percentile.median=0.60, percentile95value=0.80,root.method="multiroot")
fb_mupsi_RS$parameters
fb_mupsi_RS$summary
fb_mupsi_RS$input

fb_mupsi_NL=findbetamupsi(themean=0.20, percentile=0.99, lower.v=TRUE,
              percentile.value=0.30, psi.percentile=0.90,
              percentile.median=0.60, percentile95value=0.80,root.method="nleqslv")
fb_mupsi_RS$parameters
fb_mupsi_NL$parameters
# Results are similar

```
\newpage
## Raw findbetamupsi updated (Hierarchical input)
```{r  include=TRUE}
source("~/GitHub/PriorGen-1/R/findbetamupsi_raw.r")
require(rootSolve)
fb_mupsi_raw=findbetamupsi_raw(themean=0.20,thevariance = 0.05, psi.percentile=0.90,
              percentile.median=0.50, percentile95value=0.60,silent = TRUE)
fb_mupsi_raw$parameters
fb_mupsi_raw$summary
fb_mupsi_raw$input
```
\newpage
## Abstract findbetamupsi updated (Hierarchical input)
```{r  include=TRUE}
source("~/GitHub/PriorGen-1/R/findbetamupsi_abstract.r")
require(rootSolve)
fb_mupsi_abstract=findbetamupsi_abstract(themean="Average",thevariance = "Very high", 
                                         psi.percentile=0.90,percentile.median=0.999,
                                         percentile95value=0.9999,silent = TRUE)
fb_mupsi_abstract$parameters
fb_mupsi_abstract$summary
fb_mupsi_abstract$input
```
\newpage
## Panel findbetamupsi updated (Hierarchical input)
```{r  include=TRUE}
source("~/GitHub/PriorGen-1/R/findbetamupsi_panel.r")
require(rootSolve)
fb_mupsi_panel=findbetamupsi_panel(themean=c(0.1,0.5,0.6,0.3,0.05,0.01,0.3), 
                                   psi.percentile=0.90, percentile.median=0.50,
                                   percentile95value=0.60,silent = TRUE)
fb_mupsi_panel$parameters
fb_mupsi_panel$summary
fb_mupsi_panel$input

```
\newpage 
# Plot for findbeta
```{r  include=TRUE}
source("~/GitHub/PriorGen-1/R/findbeta_plot.r")
fb_pr=findbeta(themean = 0.5,lower.v = T,percentile = 0.999,percentile.value = 0.999,silent = T) 
findbeta_plot(fb_pr,main="Elicited beta prior (Percentile)",ylab = "Density",lwd=3,type="l")
```
\newpage
# Plot for finbeta_raw
```{r  include=TRUE}
source("~/GitHub/PriorGen-1/R/findbeta_plot.r")
fb_raw=findbeta_raw(themean = 0.5,thevariance = 0.5) 
findbeta_plot(fb_raw,main="Elicited beta prior (Raw)",ylab = "Density",lwd=3,type="l")
```
\newpage
# Plot for findbeta_abstract
```{r  include=TRUE}
source("~/GitHub/PriorGen-1/R/findbeta_plot.r")
fb_abstract=findbeta_abstract(themean.cat = "Low",thevariance.cat = "High") 
findbeta_plot(fb_abstract,main="Elicited beta prior (Abstract)",ylab = "Density",lwd=3,type="l")
```
\newpage
# Plot for findbeta_panel
```{r  include=TRUE}
source("~/GitHub/PriorGen-1/R/findbeta_plot.r")
fb_panel1=findbeta_panel(themean.vec = c(0.2,0.02,0.5,0.03,0.04,0.05),silent = T) 
fb_panel2=findbeta_panel(themean.vec = c(0.2,0.02,0.5,0.4,0.04,0.05),silent =T) 
findbeta_plot(fb_panel1,main="Elicited beta prior  (Panel)",ylab = "Density",lwd=3,type="l")
findbeta_plot(fb_panel2,lwd=3,type="l",lines = T,lty=2)
legend("topright",c("Panel 1", "Panel 2"),lty = c(1,2),lwd=3)
```
\newpage
# Plot for findbetaqq
```{r  include=TRUE}
source("~/GitHub/PriorGen-1/R/findbeta_plot.r")
require(rootSolve)
fb_qq=findbetaqq(percentile.value1 = 0.3,percentile1 = 0.20,
percentile.value2 = 0.7,percentile2 = 0.97,silent=T) 

findbeta_plot(fb_qq,main="Elicited beta prior (Percentiles method)",ylab = "Density",lwd=3,type="l")
```
\newpage
# Plots for finbetamupsi
```{r  include=TRUE}
source("~/GitHub/PriorGen-1/R/findbetamupsi.r")
source("~/GitHub/PriorGen-1/R/findbeta_plot.r")
require(rootSolve)
fb_mupsi=findbetamupsi(themean=0.20, percentile=0.99, lower.v=TRUE,
              percentile.value=0.30, psi.percentile=0.90,
              percentile.median=0.50, percentile95value=0.60,silent = TRUE)
par(mfrow=c(1,3))
plot(density(fb_mupsi$bot_param$at),lwd=3,main="Density plot for samples of a=mu*psi") # 
plot(density(fb_mupsi$bot_param$at),lwd=3,main="Density plot for samples of b=mu*(1-psi)") # 
fb_mupsi$parameters[1]=mean(fb_mupsi$bot_param$at)
fb_mupsi$parameters[2]=mean(fb_mupsi$bot_param$bt)
findbeta_plot(fb_mupsi,main="Elicited beta prior (Hierarchical prior top level)",
              ylab = "Density",lwd=3,type="l")
fb_mupsi1=findbetamupsi(themean=0.30, percentile=0.8, lower.v=TRUE,
              percentile.value=0.30, psi.percentile=0.90,
              percentile.median=0.70, percentile95value=0.80,silent = TRUE)
findbeta_plot(fb_mupsi1,main="Elicited beta prior (Hierarchical prior top level)",
              ylab = "Density",lwd=3,type="l",lines = T,lty=2,col="gray")
legend("topright",c("Basic","Basic1"),col=c("black","gray"),lty=1:2,lwd=3)

```
\newpage
# Plots for findbetamupsi_raw
```{r  include=TRUE}
source("~/GitHub/PriorGen-1/R/findbetamupsi_raw.r")
source("~/GitHub/PriorGen-1/R/findbeta_plot.r")
require(rootSolve)
fb_mupsi_raw=findbetamupsi_raw(themean=0.20, thevariance = 0.1, psi.percentile=0.90,
                               percentile.median=0.50, percentile95value=0.60,silent = TRUE)
par(mfrow=c(1,3))
plot(density(fb_mupsi_abstract$bot_param$at),lwd=3,main="Density plot for samples of a=mu*psi") # 
plot(density(fb_mupsi_abstract$bot_param$at),lwd=3,main="Density plot for samples of b=mu*(1-psi)") # 
fb_mupsi_abstract$parameters[1]=mean(fb_mupsi_abstract$bot_param$at)
fb_mupsi_abstract$parameters[2]=mean(fb_mupsi_abstract$bot_param$bt)
findbeta_plot(fb_mupsi_raw,main="Elicited beta prior (Hierarchical prior top level)",
              ylab = "Density",lwd=3,type="l")
fb_mupsi_raw1=findbetamupsi_raw(themean=0.30, thevariance = 0.15, psi.percentile=0.90,
              percentile.median=0.95, percentile95value=0.99,silent = TRUE)
findbeta_plot(fb_mupsi_raw1,main="Elicited beta prior (Hierarchical prior top level)",
              ylab = "Density",lwd=3,type="l",lines = T,lty=2,col="gray")
legend("topright",c("Raw","Raw1"),col=c("black","gray"),lty=1:2,lwd=3)
```
\newpage
# Plots for findbetamupsi_abstract
```{r  include=TRUE}
source("~/GitHub/PriorGen-1/R/findbetamupsi_abstract.r")
source("~/GitHub/PriorGen-1/R/findbeta_plot.r")
require(rootSolve)
fb_mupsi_abstract=findbetamupsi_abstract(themean="Low", thevariance = "High", 
psi.percentile=0.90, percentile.median=0.95, percentile95value=0.98,silent = FALSE)
par(mfrow=c(1,3))
plot(density(fb_mupsi_abstract$bot_param$at),lwd=3,main="Density plot for samples of a=mu*psi") # 
plot(density(fb_mupsi_abstract$bot_param$at),lwd=3,main="Density plot for samples of b=mu*(1-psi)") # 
fb_mupsi_abstract$parameters[1]=mean(fb_mupsi_abstract$bot_param$at)
fb_mupsi_abstract$parameters[2]=mean(fb_mupsi_abstract$bot_param$bt)
findbeta_plot(fb_mupsi_abstract,main="Elicited beta prior (Hierarchical prior top level)",
              ylab = "Density",lwd=3,type="l")
fb_mupsi_abstract1=findbetamupsi_abstract(themean="Very low", thevariance = "Average", psi.percentile=0.90,percentile.median=0.95, percentile95value=0.98,silent = FALSE)
findbeta_plot(fb_mupsi_abstract1,main="Elicited beta prior (Hierarchical prior top level)",
              ylab = "Density",lwd=3,type="l",lines = T,lty=2,col="gray")
legend("topright",c("Abstract","Abstract1"),col=c("black","gray"),lty=1:2,lwd=3)

```
\newpage
# Plots for findbetamupsi_panel
```{r  include=TRUE}
source("~/GitHub/PriorGen-1/R/findbetamupsi_panel.r")
source("~/GitHub/PriorGen-1/R/findbeta_plot.r")
require(rootSolve)
fb_mupsi_panel=findbetamupsi_panel(themean=c(0.1,0.5,0.05,0.01,0.4,0.2), psi.percentile=0.90,
                                   percentile.median=0.50, percentile95value=0.60,silent = TRUE)
par(mfrow=c(1,3))
plot(density(fb_mupsi_panel$bot_param$at),lwd=3,main="Density plot for samples of a=mu*psi") # 
plot(density(fb_mupsi_panel$bot_param$at),lwd=3,main="Density plot for samples of b=mu*(1-psi)") # 
fb_mupsi_panel$parameters[1]=mean(fb_mupsi_panel$bot_param$at)
fb_mupsi_panel$parameters[2]=mean(fb_mupsi_panel$bot_param$bt)
findbeta_plot(fb_mupsi_panel,main="Elicited beta prior (Hierarchical prior top level)",
              ylab = "Density",lwd=3,type="l")
fb_mupsi_panel1=findbetamupsi_panel(themean=c(0.1,0.5,0.05,0.01,0.6,0.65), psi.percentile=0.90,
              percentile.median=0.80, percentile95value=0.90,silent = TRUE)
findbeta_plot(fb_mupsi_panel1,main="Elicited beta prior (Hierarchical prior top level)",
              ylab = "Density",lwd=3,type="l",lines = T,lty=2,col="gray")
legend("topright",c("Panel","Panel1"),col=c("black","gray"),lty=1:2,lwd=3)

```
\newpage
# New root and optim functions 